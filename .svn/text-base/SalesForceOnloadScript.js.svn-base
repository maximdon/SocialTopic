document.write("<script src=\"http://www.softlibsw.com/JS/jquery-1.3.2.min.js\" type=\"text/javascript\"></script>");
document.write("<form method=\"post\" id=\"SoftlibForm\" action=\"http://localhost:8080/iMatch/pages/index.jsf\" target=\"_blank\">");
document.write("<input type=\"hidden\" id=\"SoftlibSubject\" name=\"SoftlibSubject\" />");
document.write("<input type=\"hidden\" id=\"SoftlibBody\" name=\"SoftlibBody\" />");
document.write("<input type=\"hidden\" id=\"SoftlibUUID\" name=\"SoftlibUUID\" />");
document.write("</form>");

var TrackerInterval;

function addLoadEvent(func) {
	if (document.readyState == "complete") {
		func();
	}
	else
	{
		var oldonload = window.onload;
		if (typeof window.onload != 'function') {
			window.onload = func;
		}
		else
		{
			window.onload = function() {
				if (oldonload) {
					oldonload();
				}

				func();
			}
		}
	}
}

addLoadEvent(function() {
	jQuery("#SoftlibUUID").val(new Date().getTime());
	
	var SoftlibMatchButton = jQuery("<input type='submit' class='btn' name='SoftlibMatchButton' value='Match' title='Get Match with iMatch' />");
	
	jQuery("#" + buttonRowID).prepend(SoftlibMatchButton);
	
	if(SoftlibMatchButton) {
		SoftlibMatchButton.click(function()
		{
			var subject = window.parent.document.getElementById(subjectID);
			var body = window.parent.document.getElementById(bodyID);
			var SoftlibSubject = window.parent.document.getElementById("SoftlibSubject");
			var SoftlibBody = window.parent.document.getElementById("SoftlibBody");
			
			if (SoftlibSubject && SoftlibBody && subject && body)
			{
				if (subject.value != "" && body.value != "")
				{
					SoftlibSubject.value = subject.value;
					SoftlibBody.value = body.value;
					document.getElementById("SoftlibForm").submit();
					//TrackerInterval = setInterval(checkTracker, 5000); 
				}
				else
				{
					alert("Please fill in title and description.");
				}
			}
			
			return false;
		});
	}
});

function checkTracker()
{
	clearInterval(TrackerInterval);
	jQuery.ajax({
	  url: "http://localhost:8080/iMatch/pages/tracker.jsf",
	  cache: false,
	  data: ({id : jQuery("#SoftlibUUID").val()}),
	  success: function(html){
		alert(html);
	  }
	});
}